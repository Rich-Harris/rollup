#!/usr/bin/env node

import { writeFile } from 'node:fs/promises';
import { fileURLToPath } from 'node:url';
import { astNodeNamesWithFieldOrder } from './ast-types.js';
import { runWithEcho, toScreamingSnakeCase } from './helpers.js';

const astConstantsFile = new URL(
	'../rust/parse_ast/src/convert_ast/converter/ast_constants.rs',
	import.meta.url
);

const nodeTypes = astNodeNamesWithFieldOrder
	.map(
		({ name }, index) =>
			`pub const TYPE_${toScreamingSnakeCase(name)}: [u8; 4] = ${index}u32.to_ne_bytes();`
	)
	.join('\n');

const astConstants = `// This file is generated by scripts/generate-ast-converters.js.
// Do not edit this file directly.

${nodeTypes}
`;

await writeFile(astConstantsFile, astConstants);
await runWithEcho('rustfmt', [fileURLToPath(astConstantsFile)]);
